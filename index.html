<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divine RizQ - ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- Monetag Ads -->
    <script>
        (function(m,o,n,e,t,a,g){
            m['__Monetag']=t;m[t]=m[t]||function(){(m[t].q=m[t].q||[]).push(arguments)};
            a=o.createElement(n);g=o.getElementsByTagName(n)[0];
            a.async=1;a.src=e;g.parentNode.insertBefore(a,g)
        })(window,document,'script','https://monetag.com/script.js','monetag');
    </script>

    <style>
        /* Additional inline styles for critical elements */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(160, 32, 240, 0.3);
            border-top: 4px solid var(--neon-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div>Divine RizQ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    </div>

    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">Divine RizQ</div>
            <div class="user-balance">
                <span id="balanceAmount">0.00 ISLM</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard-page">
                <div class="card">
                    <div class="balance-display">
                        <div class="balance-label">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
                        <div class="balance-amount" id="mainBalance">0.00 ISLM</div>
                    </div>
                </div>

                <div class="card">
                    <h3>‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶è‡¶ï‡¶∂‡¶®</h3>
                    <button class="btn btn-primary" id="watchAdBtn">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® (+0.02 ISLM)</button>
                    <button class="btn btn-secondary" id="dailyRewardBtn">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</button>
                    <button class="btn btn-secondary" id="tasksBtn">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button class="btn btn-secondary" id="referralBtn">‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalEarned">0.00</div>
                        <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeDays">0</div>
                        <div class="stat-label">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶¶‡¶ø‡¶®</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedTasks">0</div>
                        <div class="stat-label">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="referralCount">0</div>
                        <div class="stat-label">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</div>
                    </div>
                </div>

                <div class="card">
                    <h3>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</h3>
                    <div id="recentActivity">
                        <div class="activity-item">
                            <span>‡¶è‡¶ñ‡¶®‡¶á ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®!</span>
                            <span class="activity-time">‡¶è‡¶ñ‡¶®</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ads Page -->
            <div class="page" id="ads-page">
                <div class="card">
                    <h3>‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶≤‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® 0.02 ISLM</p>
                    
                    <div class="ad-options">
                        <button class="btn btn-primary ad-btn" data-type="interstitial">
                            <span>üì∫</span>
                            <span>‡¶´‡ßÅ‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶è‡¶°</span>
                            <span class="ad-reward">+0.02 ISLM</span>
                        </button>
                        <button class="btn btn-primary ad-btn" data-type="popup">
                            <span>ü™ü</span>
                            <span>‡¶™‡¶™‡¶Ü‡¶™ ‡¶è‡¶°</span>
                            <span class="ad-reward">+0.02 ISLM</span>
                        </button>
                        <button class="btn btn-secondary ad-btn" data-type="auto">
                            <span>üîÑ</span>
                            <span>‡¶Ö‡¶ü‡ßã ‡¶è‡¶°</span>
                            <span class="ad-reward">+0.02 ISLM</span>
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3>‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ</h3>
                    <div class="info-box">
                        <ul>
                            <li>‡¶è‡¶° ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶π‡¶¨‡ßá</li>
                            <li>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶è‡¶°-‡¶è 0.02 ISLM ‡¶™‡¶æ‡¶¨‡ßá‡¶®</li>
                            <li>‡¶¶‡¶ø‡¶®‡ßá ‡¶Ø‡¶§ ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</li>
                            <li>‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶® ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá ‡¶®‡¶æ</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tasks Page -->
            <div class="page" id="tasks-page">
                <div class="card">
                    <h3>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <p>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    
                    <div id="tasksContainer">
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Visit Our Website</div>
                                <div class="task-description">Visit our website for 30 seconds</div>
                                <div class="task-reward">Reward: 0.30 ISLM</div>
                            </div>
                            <button class="btn btn-primary" data-task-id="task_001">
                                Start Task
                            </button>
                        </div>
                        
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Follow on Telegram</div>
                                <div class="task-description">Follow our Telegram channel</div>
                                <div class="task-reward">Reward: 0.50 ISLM</div>
                            </div>
                            <button class="btn btn-primary" data-task-id="task_002">
                                Start Task
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daily Reward Page -->
            <div class="page" id="daily-page">
                <div class="card">
                    <div class="reward-card">
                        <div class="reward-icon">üéÅ</div>
                        <div class="reward-amount">0.50 ISLM</div>
                        <div class="reward-message" id="rewardMessage">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß!</div>
                        <button class="btn btn-primary" id="claimRewardBtn">‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶®</button>
                    </div>
                </div>

                <div class="card">
                    <h3>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ</h3>
                    <div class="info-box">
                        <ul>
                            <li>‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡ß≠ ‡¶¶‡¶ø‡¶®: 0.50 ISLM ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®</li>
                            <li>‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶Ø‡¶º ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡ßá‡¶Æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</li>
                            <li>‡¶¶‡¶ø‡¶® ‡ßÆ ‡¶•‡ßá‡¶ï‡ßá: ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶´‡¶æ‡¶∞</li>
                            <li>‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶ø‡¶§ ‡¶Ü‡¶∏‡ßÅ‡¶®, ‡¶¨‡ßá‡¶∂‡¶ø ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                        </ul>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡ß≠ ‡¶¶‡¶ø‡¶®</span>
                            <span id="daysProgress">0/7 ‡¶¶‡¶ø‡¶®</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referral Page -->
            <div class="page" id="referral-page">
                <div class="card">
                    <h3>‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <p>‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶§‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ 10%</p>
                    
                    <div class="referral-link-container">
                        <input type="text" id="referralLink" readonly class="referral-input" value="‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...">
                        <button class="btn btn-primary" id="copyLinkBtn">‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                </div>

                <div class="card">
                    <h3>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalReferrals">0</div>
                            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="referralEarnings">0.00</div>
                            <div class="stat-label">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ü‡¶Ø‡¶º</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h3>
                    <div class="info-box">
                        <h4>üí∞ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá:</h4>
                        <ul>
                            <li>‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá</li>
                            <li>‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ 10% ‡¶™‡¶æ‡¶¨‡ßá‡¶®</li>
                            <li>‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶®‡ßá‡¶á - ‡¶Ø‡¶§ ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</li>
                            <li>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ü‡¶Ø‡¶º ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Withdraw Page -->
            <div class="page" id="withdraw-page">
                <div class="card">
                    <h3>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    
                    <div class="info-box">
                        <h4>‚ö†Ô∏è ‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡ßÄ:</h4>
                        <ul>
                            <li>‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: <strong>28 ISLM</strong></li>
                            <li>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: <strong>2%</strong></li>
                            <li>‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <strong>10%</strong></li>
                            <li>‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶∏‡¶Æ‡¶Ø‡¶º: ‡ß®‡ß™-‡ß™‡ßÆ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ</li>
                        </ul>
                        <p style="color: var(--warning); margin-top: 10px;">
                            ‚ö†Ô∏è ‡¶Ø‡¶¶‡¶ø ‡¶´‡ßã‡¶≤‡ßã/‡¶Ü‡¶®‡¶´‡ßã‡¶≤‡ßã ‡¶ö‡¶ø‡¶ü ‡¶ï‡¶∞‡ßá‡¶®, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶π‡¶æ‡¶∞‡¶æ‡¶Æ ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
                        </p>
                    </div>

                    <form id="withdrawForm">
                        <div class="form-group">
                            <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (ISLM)</label>
                            <input type="number" id="withdrawAmount" min="28" step="0.01" placeholder="28" required>
                            <div class="form-hint">‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶®: 28 ISLM</div>
                        </div>
                        
                        <div class="form-group">
                            <label>‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                            <select id="withdrawMethod" required>
                                <option value="">‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                <option value="bKash">bKash (‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂)</option>
                                <option value="Nagad">Nagad (‡¶®‡¶ó‡¶¶)</option>
                                <option value="BTC">Bitcoin (‡¶¨‡¶ø‡¶ü‡¶ï‡¶Ø‡¶º‡ßá‡¶®)</option>
                                <option value="ETH">Ethereum (‡¶á‡¶•‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ)</option>
                                <option value="ISLM_TON">ISLM on TON Blockchain</option>
                            </select>
                        </div>

                        <div class="form-group" id="walletField" style="display: none;">
                            <label id="walletLabel">‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏ / ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
                            <input type="text" id="walletAddress" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶¨‡¶æ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required>
                        </div>
                        
                        <div class="calculation-box">
                            <div class="calc-row">
                                <span>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</span>
                                <span id="calcAmount">0.00 ISLM</span>
                            </div>
                            <div class="calc-row">
                                <span>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (2%):</span>
                                <span id="calcFee">0.00 ISLM</span>
                            </div>
                            <div class="calc-row total">
                                <span>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</span>
                                <span id="calcTotal">0.00 ISLM</span>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" id="submitWithdrawBtn">
                            ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                    </form>
                </div>

                <div class="card">
                    <h3>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
                    <div id="withdrawHistory">
                        <div class="history-item">
                            <span>‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶®‡ßá‡¶á</span>
                            <span class="history-status">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-page="dashboard">
                <span>üè†</span>
                <span>‡¶π‡ßã‡¶Æ</span>
            </button>
            <button class="nav-btn" data-page="ads">
                <span>üì∫</span>
                <span>‡¶è‡¶°</span>
            </button>
            <button class="nav-btn" data-page="tasks">
                <span>‚úÖ</span>
                <span>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span>
            </button>
            <button class="nav-btn" data-page="daily">
                <span>üéÅ</span>
                <span>‡¶¶‡ßà‡¶®‡¶ø‡¶ï</span>
            </button>
            <button class="nav-btn" data-page="referral">
                <span>üë•</span>
                <span>‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span>
            </button>
            <button class="nav-btn" data-page="withdraw">
                <span>üí∞</span>
                <span>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span>
            </button>
        </nav>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB_-PefTn0NVzSJpkAS0o71zfPCb5Yhkr4",
            authDomain: "divine-rizq.firebaseapp.com",
            projectId: "divine-rizq",
            storageBucket: "divine-rizq.firebasestorage.app",
            messagingSenderId: "864023029515",
            appId: "1:864023029515:web:9f1dc6e02d259910c6a40e",
            measurementId: "G-33XFBDN1L6"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        console.log("üî• Firebase Connected Successfully!");
        window.db = db;
        window.firebase = firebase;
    </script>

    <!-- Main App Script -->
    <script>
        // Main Application Logic
        class DivineRizqApp {
            constructor() {
                this.currentUser = null;
                this.userData = null;
                this.tg = null;
                this.demoMode = false;
                this.init();
            }

            init() {
                console.log('üöÄ Divine RizQ App Initializing...');
                
                // Hide loading screen after 2 seconds
                setTimeout(() => {
                    this.hideLoadingScreen();
                }, 2000);
                
                // Initialize Telegram WebApp
                this.initTelegram();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Load user data from Firebase
                this.loadUserData();
            }

            hideLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                const appContainer = document.getElementById('appContainer');
                
                if (loadingScreen && appContainer) {
                    loadingScreen.style.display = 'none';
                    appContainer.style.display = 'block';
                }
            }

            initTelegram() {
                try {
                    this.tg = window.Telegram.WebApp;
                    
                    if (this.tg && this.tg.initDataUnsafe.user) {
                        this.tg.expand();
                        this.tg.enableClosingConfirmation();
                        console.log('‚úÖ Telegram WebApp initialized');
                        document.body.classList.add('telegram-app');
                        return true;
                    } else {
                        throw new Error('No Telegram user data');
                    }
                } catch (error) {
                    console.log('üåê Running in Browser - Demo mode');
                    this.demoMode = true;
                    document.body.classList.add('demo-mode');
                    return false;
                }
            }

            async loadUserData() {
                if (this.demoMode) {
                    this.loadDemoData();
                    return;
                }

                try {
                    const telegramUser = this.tg.initDataUnsafe.user;
                    const userId = `user_${telegramUser.id}`;
                    const username = telegramUser.username || 
                                   `${telegramUser.first_name}${telegramUser.last_name ? ' ' + telegramUser.last_name : ''}`;

                    // Check for referral
                    const urlParams = new URLSearchParams(window.location.search);
                    const refCode = urlParams.get('ref');

                    const userDoc = await db.collection('users').doc(userId).get();

                    if (userDoc.exists) {
                        // Existing user
                        this.userData = userDoc.data();
                        console.log('‚úÖ User data loaded:', this.userData);
                    } else {
                        // New user - create document
                        this.userData = {
                            uid: userId,
                            username: username,
                            balance: 0.0,
                            joinedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            dailyRewardClaimed: false,
                            daysFromJoin: 0,
                            referral: refCode || "none",
                            totalEarned: 0.0,
                            completedTasks: [],
                            totalReferrals: 0,
                            referralEarnings: 0.0,
                            lastActivity: firebase.firestore.FieldValue.serverTimestamp()
                        };

                        await db.collection('users').doc(userId).set(this.userData);
                        console.log('‚úÖ New user created:', this.userData);
                        
                        // Process referral if any
                        if (refCode && refCode !== "none") {
                            this.processReferral(refCode, userId);
                        }
                    }

                    this.updateUI();
                } catch (error) {
                    console.error('‚ùå Error loading user data:', error);
                    this.loadDemoData();
                }
            }

            async processReferral(referrerId, newUserId) {
                try {
                    // Add referral to referrer's count
                    await db.collection('users').doc(referrerId).update({
                        totalReferrals: firebase.firestore.FieldValue.increment(1)
                    });
                    console.log(`‚úÖ Referral processed: ${newUserId} referred by ${referrerId}`);
                } catch (error) {
                    console.error('Error processing referral:', error);
                }
            }

            loadDemoData() {
                this.userData = {
                    balance: 12.50,
                    totalEarned: 25.75,
                    daysFromJoin: 3,
                    dailyRewardClaimed: false,
                    username: 'Demo User',
                    completedTasks: ['task_001'],
                    totalReferrals: 2,
                    referralEarnings: 1.50
                };
                this.updateUI();
                this.showDemoNotice();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const page = e.currentTarget.dataset.page;
                        this.switchPage(page);
                    });
                });

                // Quick action buttons
                document.getElementById('watchAdBtn').addEventListener('click', () => {
                    this.watchAd();
                });

                document.getElementById('dailyRewardBtn').addEventListener('click', () => {
                    this.switchPage('daily');
                });

                document.getElementById('tasksBtn').addEventListener('click', () => {
                    this.switchPage('tasks');
                    this.loadTasks();
                });

                document.getElementById('referralBtn').addEventListener('click', () => {
                    this.switchPage('referral');
                });

                // Ad buttons
                document.querySelectorAll('.ad-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const type = e.currentTarget.dataset.type;
                        this.showAd(type);
                    });
                });

                // Daily reward
                document.getElementById('claimRewardBtn').addEventListener('click', () => {
                    this.claimDailyReward();
                });

                // Referral
                document.getElementById('copyLinkBtn').addEventListener('click', () => {
                    this.copyReferralLink();
                });

                // Withdraw form
                document.getElementById('withdrawForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitWithdrawal();
                });

                // Withdraw amount calculation
                document.getElementById('withdrawAmount').addEventListener('input', (e) => {
                    this.calculateWithdrawal(e.target.value);
                });

                // Withdraw method change
                document.getElementById('withdrawMethod').addEventListener('change', (e) => {
                    this.toggleWalletField(e.target.value);
                });

                // Task buttons
                document.addEventListener('click', (e) => {
                    if (e.target.matches('[data-task-id]')) {
                        const taskId = e.target.dataset.taskId;
                        this.startTask(taskId);
                    }
                });
            }

            switchPage(pageId) {
                // Hide all pages
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });

                // Show target page
                document.getElementById(`${pageId}-page`).classList.add('active');

                // Update nav buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

                // Page specific setup
                this.setupPage(pageId);
            }

            setupPage(pageId) {
                switch(pageId) {
                    case 'referral':
                        this.setupReferralPage();
                        break;
                    case 'withdraw':
                        this.setupWithdrawPage();
                        break;
                    case 'daily':
                        this.setupDailyPage();
                        break;
                }
            }

            setupReferralPage() {
                if (this.demoMode) {
                    document.getElementById('referralLink').value = 'https://t.me/your_bot?start=ref_demo';
                } else {
                    const referralLink = `${window.location.origin}${window.location.pathname}?ref=${this.tg.initDataUnsafe.user.id}`;
                    document.getElementById('referralLink').value = referralLink;
                }
                
                // Update referral stats
                document.getElementById('totalReferrals').textContent = this.userData.totalReferrals || 0;
                document.getElementById('referralEarnings').textContent = (this.userData.referralEarnings || 0).toFixed(2);
            }

            setupWithdrawPage() {
                this.calculateWithdrawal(28); // Default minimum
                this.toggleWalletField('');
            }

            setupDailyPage() {
                const days = this.userData.daysFromJoin || 0;
                const progress = Math.min((days / 7) * 100, 100);
                
                document.getElementById('daysProgress').textContent = `${days}/7 ‡¶¶‡¶ø‡¶®`;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            toggleWalletField(method) {
                const walletField = document.getElementById('walletField');
                const walletLabel = document.getElementById('walletLabel');
                const walletInput = document.getElementById('walletAddress');
                
                if (method) {
                    walletField.style.display = 'block';
                    
                    switch(method) {
                        case 'bKash':
                        case 'Nagad':
                            walletLabel.textContent = '‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞';
                            walletInput.placeholder = '01XXXXXXXXX';
                            break;
                        default:
                            walletLabel.textContent = '‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏';
                            walletInput.placeholder = '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®';
                    }
                } else {
                    walletField.style.display = 'none';
                }
            }

            calculateWithdrawal(amount) {
                if (!amount || amount < 28) {
                    amount = 28;
                }
                
                const fee = amount * 0.02;
                const total = amount - fee;
                
                document.getElementById('calcAmount').textContent = `${parseFloat(amount).toFixed(2)} ISLM`;
                document.getElementById('calcFee').textContent = `${fee.toFixed(2)} ISLM`;
                document.getElementById('calcTotal').textContent = `${total.toFixed(2)} ISLM`;
            }

            async loadTasks() {
                try {
                    // For demo, we'll use static tasks
                    const tasks = [
                        {
                            id: 'task_001',
                            title: 'Visit Our Website',
                            description: 'Visit our website for 30 seconds',
                            reward: 0.30,
                            link: 'https://example.com'
                        },
                        {
                            id: 'task_002', 
                            title: 'Follow on Telegram',
                            description: 'Follow our Telegram channel',
                            reward: 0.50,
                            link: 'https://t.me/your_channel'
                        }
                    ];

                    const tasksContainer = document.getElementById('tasksContainer');
                    let tasksHTML = '';

                    tasks.forEach(task => {
                        const isCompleted = this.userData.completedTasks && 
                                          this.userData.completedTasks.includes(task.id);

                        tasksHTML += `
                            <div class="task-item">
                                <div class="task-info">
                                    <div class="task-title">${task.title}</div>
                                    <div class="task-description">${task.description}</div>
                                    <div class="task-reward">Reward: ${task.reward} ISLM</div>
                                </div>
                                <button class="btn ${isCompleted ? 'btn-secondary' : 'btn-primary'}" 
                                        data-task-id="${task.id}"
                                        ${isCompleted ? 'disabled' : ''}>
                                    ${isCompleted ? 'Completed' : 'Start Task'}
                                </button>
                            </div>
                        `;
                    });

                    tasksContainer.innerHTML = tasksHTML;

                } catch (error) {
                    console.error('Error loading tasks:', error);
                }
            }

            async startTask(taskId) {
                this.showNotification('Task started! Complete the task to earn reward.', 'info');
                
                // Simulate task completion after 3 seconds
                setTimeout(() => {
                    this.completeTask(taskId, 0.30);
                }, 3000);
            }

            async completeTask(taskId, reward) {
                try {
                    if (this.demoMode) {
                        this.addBalance(reward, 'Task Reward');
                        // Mark as completed in demo
                        if (!this.userData.completedTasks) {
                            this.userData.completedTasks = [];
                        }
                        this.userData.completedTasks.push(taskId);
                        this.updateUI();
                        return;
                    }

                    const userId = `user_${this.tg.initDataUnsafe.user.id}`;
                    const updatedCompletedTasks = [...(this.userData.completedTasks || []), taskId];

                    await db.collection('users').doc(userId).update({
                        balance: firebase.firestore.FieldValue.increment(reward),
                        totalEarned: firebase.firestore.FieldValue.increment(reward),
                        completedTasks: updatedCompletedTasks,
                        lastActivity: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Update local data
                    this.userData.balance += reward;
                    this.userData.totalEarned += reward;
                    this.userData.completedTasks = updatedCompletedTasks;

                    this.updateUI();
                    this.showNotification(`Task completed! +${reward} ISLM`, 'success');

                } catch (error) {
                    console.error('Error completing task:', error);
                    this.showNotification('Error completing task', 'error');
                }
            }

            async watchAd() {
                if (this.demoMode) {
                    this.addBalance(0.02, 'Ad Reward');
                    return;
                }

                try {
                    // Show ad using Monetag
                    if (typeof monetag !== 'undefined' && monetag.show_10076761) {
                        monetag.show_10076761().then(() => {
                            this.giveAdReward();
                        }).catch(error => {
                            console.error('Ad error:', error);
                            // Fallback for testing
                            this.giveAdReward();
                        });
                    } else {
                        // Fallback if Monetag not loaded
                        this.giveAdReward();
                    }
                } catch (error) {
                    console.error('Ad error:', error);
                    // Fallback - give reward anyway for testing
                    this.giveAdReward();
                }
            }

            async showAd(type) {
                this.showNotification(`Showing ${type} ad...`, 'info');
                
                // Simulate ad watching
                setTimeout(() => {
                    this.giveAdReward();
                }, 2000);
            }

            async giveAdReward() {
                const reward = 0.02;
                
                if (this.demoMode) {
                    this.addBalance(reward, 'Ad Reward');
                    return;
                }

                try {
                    const userId = `user_${this.tg.initDataUnsafe.user.id}`;
                    
                    await db.collection('users').doc(userId).update({
                        balance: firebase.firestore.FieldValue.increment(reward),
                        totalEarned: firebase.firestore.FieldValue.increment(reward),
                        lastActivity: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Update local data
                    this.userData.balance += reward;
                    this.userData.totalEarned += reward;

                    this.updateUI();
                    this.showNotification(`Ad completed! +${reward} ISLM`, 'success');

                } catch (error) {
                    console.error('Error updating balance:', error);
                    this.showNotification('Error updating balance', 'error');
                }
            }

            async claimDailyReward() {
                if (this.userData.dailyRewardClaimed) {
                    this.showNotification('You have already claimed your daily reward today!', 'warning');
                    return;
                }

                if (this.userData.daysFromJoin >= 7) {
                    this.showNotification('Daily rewards are only available for the first 7 days', 'warning');
                    return;
                }

                const reward = 0.50;

                if (this.demoMode) {
                    this.addBalance(reward, 'Daily Reward');
                    this.userData.dailyRewardClaimed = true;
                    this.userData.daysFromJoin = (this.userData.daysFromJoin || 0) + 1;
                    this.updateUI();
                    return;
                }

                try {
                    const userId = `user_${this.tg.initDataUnsafe.user.id}`;
                    
                    await db.collection('users').doc(userId).update({
                        balance: firebase.firestore.FieldValue.increment(reward),
                        totalEarned: firebase.firestore.FieldValue.increment(reward),
                        dailyRewardClaimed: true,
                        daysFromJoin: firebase.firestore.FieldValue.increment(1),
                        lastActivity: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Update local data
                    this.userData.balance += reward;
                    this.userData.totalEarned += reward;
                    this.userData.dailyRewardClaimed = true;
                    this.userData.daysFromJoin = (this.userData.daysFromJoin || 0) + 1;

                    this.updateUI();
                    this.showNotification(`Daily reward claimed! +${reward} ISLM`, 'success');

                } catch (error) {
                    console.error('Error claiming daily reward:', error);
                    this.showNotification('Error claiming daily reward', 'error');
                }
            }

            updateUI() {
                if (!this.userData) return;

                // Update balance displays
                const balance = this.userData.balance.toFixed(2);
                document.getElementById('balanceAmount').textContent = `${balance} ISLM`;
                document.getElementById('mainBalance').textContent = `${balance} ISLM`;

                // Update stats
                document.getElementById('totalEarned').textContent = this.userData.totalEarned.toFixed(2);
                document.getElementById('activeDays').textContent = this.userData.daysFromJoin || 0;
                document.getElementById('completedTasks').textContent = this.userData.completedTasks ? this.userData.completedTasks.length : 0;
                document.getElementById('referralCount').textContent = this.userData.totalReferrals || 0;

                // Update daily reward button
                const claimBtn = document.getElementById('claimRewardBtn');
                if (this.userData.dailyRewardClaimed) {
                    claimBtn.disabled = true;
                    claimBtn.textContent = 'Already Claimed Today';
                    document.getElementById('rewardMessage').textContent = 'Come back tomorrow for your next reward!';
                } else {
                    claimBtn.disabled = false;
                    claimBtn.textContent = 'Claim Reward';
                    document.getElementById('rewardMessage').textContent = 'Daily Reward Available!';
                }

                // Update daily progress
                this.setupDailyPage();
            }

            showDemoNotice() {
                if (!document.getElementById('demoNotice')) {
                    const notice = document.createElement('div');
                    notice.id = 'demoNotice';
                    notice.className = 'demo-notice';
                    notice.innerHTML = 'üîß <strong>Demo Mode</strong> - Real functionality works in Telegram with Firebase';
                    document.querySelector('.main-content').prepend(notice);
                }
            }

            addBalance(amount, reason) {
                this.userData.balance += amount;
                this.userData.totalEarned += amount;
                this.updateUI();
                this.showNotification(`${reason}! +${amount} ISLM`, 'success');
            }

            copyReferralLink() {
                const linkInput = document.getElementById('referralLink');
                linkInput.select();
                
                try {
                    document.execCommand('copy');
                    this.showNotification('Referral link copied to clipboard! üìã', 'success');
                } catch (error) {
                    this.showNotification('Failed to copy link', 'error');
                }
            }

            async submitWithdrawal() {
                const amount = parseFloat(document.getElementById('withdrawAmount').value);
                const method = document.getElementById('withdrawMethod').value;
                const walletAddress = document.getElementById('walletAddress').value;

                if (!amount || amount < 28) {
                    this.showNotification('Minimum withdrawal: 28 ISLM', 'error');
                    return;
                }

                if (amount > this.userData.balance) {
                    this.showNotification('Insufficient balance', 'error');
                    return;
                }

                if (!method) {
                    this.showNotification('Please select withdrawal method', 'error');
                    return;
                }

                if (method && !walletAddress) {
                    this.showNotification('Please enter your wallet address/phone number', 'error');
                    return;
                }

                if (this.demoMode) {
                    this.showNotification(`Withdrawal request submitted! Amount: ${amount} ISLM, Method: ${method}`, 'success');
                    document.getElementById('withdrawForm').reset();
                    this.toggleWalletField('');
                    return;
                }

                try {
                    const withdrawalData = {
                        uid: this.userData.uid,
                        amount: amount,
                        method: method,
                        wallet: walletAddress,
                        status: 'pending',
                        fee: amount * 0.02,
                        netAmount: amount - (amount * 0.02),
                        requestedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection('withdrawals').add(withdrawalData);

                    // Update user balance
                    await db.collection('users').doc(this.userData.uid).update({
                        balance: firebase.firestore.FieldValue.increment(-amount),
                        lastActivity: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Update local data
                    this.userData.balance -= amount;

                    this.updateUI();
                    this.showNotification('Withdrawal request submitted successfully!', 'success');
                    document.getElementById('withdrawForm').reset();
                    this.toggleWalletField('');

                } catch (error) {
                    console.error('Error submitting withdrawal:', error);
                    this.showNotification('Error submitting withdrawal request', 'error');
                }
            }

            showNotification(message, type = 'info') {
                // Remove existing notifications
                const existing = document.querySelectorAll('.notification');
                existing.forEach(note => note.remove());

                // Create notification
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                let icon = '‚ÑπÔ∏è';
                if (type === 'success') icon = '‚úÖ';
                if (type === 'error') icon = '‚ùå';
                if (type === 'warning') icon = '‚ö†Ô∏è';

                notification.innerHTML = `
                    <span class="notification-icon">${icon}</span>
                    <span class="notification-message">${message}</span>
                    <button class="notification-close">&times;</button>
                `;

                document.body.appendChild(notification);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);

                // Close button
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    notification.remove();
                });
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new DivineRizqApp();
        });
    </script>
</body>
</html>
